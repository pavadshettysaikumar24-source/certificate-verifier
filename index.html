<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin â€“ Upload Certificate</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

<h2 id="title">Checking admin access...</h2>

<!-- ðŸ” ADMIN CONTENT (HIDDEN UNTIL VERIFIED) -->
<div id="adminContent" style="display:none;">

    <h2>Admin Panel â€“ Upload Certificate</h2>

    <!-- Optional: Show connected admin wallet -->
    <p id="adminWallet"></p>

    <input id="name" placeholder="Student Name">
    <input id="course" placeholder="Course">
    <input id="year" placeholder="Year">

    <button onclick="uploadCertificate()">Upload</button>

    <p id="uploadStatus"></p>

    <!-- ðŸ”³ QR CODE WILL APPEAR HERE -->
    <h3>Certificate QR Code</h3>
    <div id="qrcode"></div>

</div>

<!-- ===============================
     LIBRARIES
=============================== -->

<!-- ethers.js -->
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

<!-- QR Code library (REQUIRED) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<!-- ===============================
     ADMIN ACCESS CHECK (ON-CHAIN)
=============================== -->
<script>
async function checkAdmin() {
    try {
        if (!window.ethereum) {
            alert("MetaMask required for admin access");
            window.location.href = "verify.html";
            return;
        }

        const provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);

        const signer = provider.getSigner();
        const userAddress = await signer.getAddress();

        const contract = new ethers.Contract(
            "0x7b5d0F82074cE9d4AA67C435c7df517088e0af2D",
            ["function admin() view returns (address)"],
            provider
        );

        const adminAddress = await contract.admin();

        if (userAddress.toLowerCase() !== adminAddress.toLowerCase()) {
            alert("Only admin wallet can access this page");
            window.location.href = "verify.html";
            return;
        }

        // âœ… Admin verified
        document.getElementById("title").innerText = "Admin Panel â€“ Upload Certificate";
        document.getElementById("adminContent").style.display = "block";

    } catch (err) {
        console.error("Admin check failed:", err);
        window.location.href = "verify.html";
    }
}

window.addEventListener("load", checkAdmin);
</script>

<!-- ===============================
     MAIN BLOCKCHAIN LOGIC
=============================== -->
<script src="script.js"></script>

</body>
</html>
